<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Installation - Remote theme example</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Installation | Remote theme example</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Installation" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/installation/" /> <meta property="og:url" content="http://localhost:4000/installation/" /> <meta property="og:site_name" content="Remote theme example" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Installation" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Installation","url":"http://localhost:4000/installation/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Remote theme example </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="http://localhost:4000/Overview/" class="nav-list-link">Overview</a></li><li class="nav-list-item active"><a href="http://localhost:4000/installation/" class="nav-list-link active">Installation</a></li><li class="nav-list-item"><a href="http://localhost:4000/usage" class="nav-list-link">Usage</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/_posts" class="nav-list-link">About2</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/child1.html" class="nav-list-link">child page</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/Resources" class="nav-list-link">Resources</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Remote theme example" aria-label="Search Remote theme example" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <p><strong><em>All the configurations in this documantation are for version 8.3.1 of the stack.</em></strong></p> <p><strong><em>All the configuration files are included in the main branch of this repo.</em></strong></p> <p><em>Note: all the elk stack software we installed are the same version, Be carefull with the version you choose to install because elk stack does not do well with back compatibility.</em></p> <p><a href="https://www.elastic.co/support/matrix">Support Matrix for all Elastic softwares</a></p> <h1 id="elasticsearch-installation-and-configuration-on-linux"> <a href="#elasticsearch-installation-and-configuration-on-linux" class="anchor-heading" aria-labelledby="elasticsearch-installation-and-configuration-on-linux"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Elasticsearch installation and configuration on Linux </h1> <p>To download Elasticsearch archive we can use wget or curl:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.3.1-linux-x86_64.tar.gz
tar -xzf elasticsearch-8.3.1-linux-x86_64.tar.gz
cd elasticsearch-8.3.1/
</code></pre></div></div> <p>Your main config file is located at elasticsearch-8.3.1/config/elasticsearch.yml</p> <p><em>If you installed elasticsearch using apt or dpkg your config file witll be located at /etc/elasticsearch/elasticsearch.yml</em></p> <p>The archive contain a great configuration sample, it is minimal and contain all the configuration to start.</p> <p>Letâ€™s try to understand the most important ones.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
# ----------------------------------- Cluster -----------------------------------


#The cluster name is straight forward. it is the name of your cluster.

cluster.name: "myfirst-cluster"


# ------------------------------------ Node ------------------------------------

# Use a descriptive name for the node:

node.name: "master-node"

# ----------------------------------- Paths ------------------------------------

# Path to directory where to store the data, Or you can leave it and elasticsearch will store the data at the default location with is elasticsearch-8.3.1/data/

#path.data: /path/to/data

# Path to log files. Same thing we can leave it and the default log location will be elasticsearch-8.3.1/logs/

#path.logs: /path/to/log

#Note: If you are running multple nodes from the same directory you may specify each node log and data location to avoid conflictions.

# ---------------------------------- Network -----------------------------------

# By default Elasticsearch is only accessible on localhost. Set a different
# address here to expose this node on the network:

network.host: 0.0.0.0

# By default Elasticsearch listens for HTTP traffic on the first free port it
# finds starting at 9200. Set a specific HTTP port here:

http.port: 9200

# --------------------------------- Discovery ----------------------------------
#
# Discovery seed hosts are used when your nodes are hosted in diffrent hosts. If you want to run multiple nodes in the same host leave it disabled and the default seed_hosts will be set to 127.0.0.1.

#discovery.seed_hosts: ["host1", "host2"]

# If you are trying to run a single-node set the discovery type to single-node

discovery.type: single-node

# Bootstrap the cluster using an initial set of master-eligible nodes:

#cluster.initial_master_nodes: ["node-1", "node-2"]

</code></pre></div></div> <p>After configuring elasticsearch we can start it:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/elasticsearch
</code></pre></div></div> <p><img src="https://i.ibb.co/dKsWMJW/Screen-Shot-2022-07-15-at-4-54-21-PM.png" alt="elasticsearch" /></p> <p>As you can see we started elasticsearch succesfuly and it provided us with the password for elastic user and two enrollment tokens we can use them for enrolling kibana or other nodes to out cluster. Elasticsearch also provides multiple binaries to reset passwords or create enrollment tokens.</p><hr /> <h1 id="running-multple-nodes-on-the-same-host"> <a href="#running-multple-nodes-on-the-same-host" class="anchor-heading" aria-labelledby="running-multple-nodes-on-the-same-host"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running multple nodes on the same host </h1> <p>To run multiple nodes in the same host we need to reconfigure our master-node.</p> <p><a href="https://www.elastic.co/guide/en/cloud-enterprise/2.0/ece-heap.html#ece_elasticsearch_clusters_and_jvm_heap_size">Resource#1</a></p> <p>For Elasticsearch clusters, ECE gives 50% of the available memory to the JVM heap used by Elasticsearch, while leaving the other 50% for the operating system. This memory wonâ€™t go unused, as Lucene is designed to leverage the underlying OS for caching in-memory data structures, meaning that Lucene will happily gobble up whatever is left over. The ideal heap size is somewhere below 32 GB, as heap sizes above 32 GB become less efficient.</p> <p>What these recommendations mean is that on a 64 GB cluster, we dedicate 32 GB to the Elasticsearch heap and 32 GB to the operating system in the container that hosts your cluster. If you provision a 128 GB cluster, we create two 64 GB nodes, each node with 32 GB reserved for the Elasticsearch heap and 32 GB reserved for the operating system.</p> <p>To not exceed the memory limit we can set the ES_JAVA_OPTS envirment variable and specify the min and max memory usage</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export ES_JAVA_OPTS="-Xms2g -Xmx2g"
</code></pre></div></div> <p>For the master node we gonna use the same config as before, and change these parameters:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
# Set the discovery to multiple nodes

discovery.type: multi-node

# specify the data path

path.data: data-master-node

# specify the logs path

path.logs: logs-master-node

</code></pre></div></div> <p>Before running the master node we gonna generate out ssl certs to enable secure connection between nodes</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># lets generate our own CA

./bin/elasticsearch-certutil ca --pem

# after that lets generate out cert and sign it using the CA

./bin/elasticsearch-certutil cert --pem --ca-cert config/certs/ca/ca.crt --ca-key config/certs/ca/ca.key

</code></pre></div></div> <p>After generating the certificate we can configure ssl and tls in out elasticsearch.yml</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xpack.security.enabled: true
xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.key: certs/instance/instance.key
xpack.security.http.ssl.certificate: certs/instance/instance.crt
xpack.security.http.ssl.certificate_authorities: certs/ca/ca.crt
xpack.security.http.ssl.verification_mode: certificate
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.key: certs/instance/instance.key
xpack.security.transport.ssl.certificate: certs/instance/instance.crt
xpack.security.transport.ssl.certificate_authorities: certs/ca/ca.crt
xpack.security.transport.ssl.verification_mode: certificate
</code></pre></div></div> <p>After that we can run the master node as before:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/elasticsearch
</code></pre></div></div> <p>For the second node we gonna change these configs:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
# change node name

node.name: "second-node"

# change data path

path.data: data-second-node

# change logs path

path.logs: logs-second-node

# set ssl ca to enable secure connection between nodes

xpack.security.enabled: true
xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.key: certs/instance/instance.key
xpack.security.http.ssl.certificate: certs/instance/instance.crt
xpack.security.http.ssl.certificate_authorities: certs/ca/ca.crt
xpack.security.http.ssl.verification_mode: certificate
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.key: certs/instance/instance.key
xpack.security.transport.ssl.certificate: certs/instance/instance.crt
xpack.security.transport.ssl.certificate_authorities: certs/ca/ca.crt
xpack.security.transport.ssl.verification_mode: certificate


</code></pre></div></div> <p>Before running the second node we need to generate the enrollment token</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/elasticsearch-create-enrollment-token -s node
</code></pre></div></div> <p>-s flag stand for scope you can either generate an enrollment token for kibana or for another node</p> <p>now lets run the second node</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
./bin/elasticsearch --enrollment-token eyJ2ZXIiOiI4LjMuMSIsImFkciI6WyIxMC4xODIuMC4xMTo5MjAwIl0sImZnciI6IjYzMmE0NjIxZTYyYTE0ODAwNDkwYzk0MGMyOGZlNGUwZDdlOWY0YTk4NzQ1NDY1YjNkNGM5ODhkYzdhZGY4NjQiLCJrZXkiOiIzM0stQW9JQmRsWWMxeGxOaUNpYjpjUFlMd01wY1E4T010LVAyLWt0MmlBIn0=

</code></pre></div></div> <p><img src="https://i.ibb.co/RCZL9PJ/Screen-Shot-2022-07-15-at-6-17-57-PM.png" alt="master-node" /></p> <p><img src="https://i.ibb.co/Bym1CRm/Screen-Shot-2022-07-15-at-6-17-48-PM.png" alt="second-node" /></p> <p>We can see that both nodes are running and the second node succesfuly enrolled into out cluster.</p> <p>To run elasticsearch as daemon you can either use -d flag or install elasticsearch using apt.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/elasticsearch -d
</code></pre></div></div><hr /> <h1 id="installing-logstash"> <a href="#installing-logstash" class="anchor-heading" aria-labelledby="installing-logstash"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installing Logstash </h1> <p>Download logstash archive:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://artifacts.elastic.co/downloads/logstash/logstash-8.3.1-linux-x86_64.tar.gz
tar -xzf logstash-8.3.1-linux-x86_64.tar.gz
cd logstash-8.3.1-linux-x86_64
</code></pre></div></div> <p>The configuration file for logstash is located at logstash-8.3.1-linux-x86_64/config/logstash.yml</p> <p>Letâ€™s configure logstash</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Changing host to be able to access logstash externaly

http.host: "0.0.0.0"
http.port: 9600

# The pipeline.workers setting determines how many threads to run for filter and output processing.

pipeline:
  workers: 2
node:
  name: "master-node"

</code></pre></div></div> <p>We can configure logstash input and output pipelines using logstash.conf file.</p> <p>We gonna use a CSV file for testing</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
input {
    file { 
            path =&gt; "/root/logstash-8.3.1/config/Games.csv"
            start_position =&gt; ["beginning"]
            sincedb_path =&gt; "NULL"
    }
}
filter
{
    csv
        {
            separator =&gt; ","
            columns =&gt; [ "Name", "Sales", "Series", "Release", "Genre" , "Developer", "Publisher" ]
        }
}
output
{

    elasticsearch
        {
            hosts =&gt; ["https://localhost:9200"]
            
            # Specify the ca cert to trust elasticsearch cert

            cacert =&gt; "/root/config/certs/ca/ca.crt"

            # Specify index name

            index =&gt; "games"
            document_type =&gt; "sold_games"

            # Specify the credential of the user used to authenticat to elasticsearch

            user =&gt; "elastic"
            password =&gt; "elasticpassword"

    }

# stdout is a great way to debug the ouput that are gonna be sent to elasticsearch

stdout {}
}

</code></pre></div></div> <p>After that lets start logstash</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/logstash -f config/logstash.conf
</code></pre></div></div> <p>All the data is stored on elasticsearch and we can comfirm that after installing kibana.</p><hr /> <h1 id="kibana-installation"> <a href="#kibana-installation" class="anchor-heading" aria-labelledby="kibana-installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Kibana installation </h1> <p>As elasticsearch and logstash we can download the archive containing the binaries directly or we can use any package manager (Depending on your distro of choice) to install kibana.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://artifacts.elastic.co/downloads/kibana/kibana-8.3.1-linux-x86_64.tar.gz
tar -xzf kibana-8.3.1-linux-x86_64.tar.gz
cd kibana-8.3.1/
</code></pre></div></div> <p>This is the important configs we need to start kibana:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Changing host to be able to access kibana externaly

server.host: "0.0.0.0"

# Provide the host and port for your elasticsearch cluster

elasticsearch.hosts: ["https://localhost:9200"]

# Provide the crendentials to your kibana_system user, you can reset the password for this user using elasticsearch-reset-password binary.

elasticsearch.username: "kibana_system"
elasticsearch.password: kibana_password

# Provide kibana with the your CA certificate so the connection can be verified between kibana and elasticsearch

elasticsearch.ssl.verificationMode: certificate

elasticsearch.ssl.certificateAuthorities: [ "/etc/kibana/config/certs/ca/ca.crt" ]
</code></pre></div></div> <p>To run kibana:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/kibana
</code></pre></div></div> <p>After running kibana we can access it at http://localhost:5601</p> <p><img src="https://i.ibb.co/VSWhMjZ/Screen-Shot-2022-07-16-at-5-32-15-PM.png" alt="Kibana" /></p> <p>Lets confirm that logstash data is stored by checking Analytics-&gt;Discovery</p> <p>First we need to cearte a data view for the index we used in our data</p> <p><img src="https://i.ibb.co/8cyMLFN/Screen-Shot-2022-07-16-at-5-34-59-PM.png" alt="create_data_view#1" /></p> <p><img src="https://i.ibb.co/vYftmbP/Screen-Shot-2022-07-16-at-5-35-14-PM.png" alt="data" /></p><hr /> <h1 id="monitor-a-windows-machine-using-sysmon-logs"> <a href="#monitor-a-windows-machine-using-sysmon-logs" class="anchor-heading" aria-labelledby="monitor-a-windows-machine-using-sysmon-logs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monitor a windows machine using sysmon logs </h1> <ul> <li>Download Sysmon</li> </ul> <p><a href="https://download.sysinternals.com/files/SysinternalsSuite.zip">https://download.sysinternals.com/files/SysinternalsSuite.zip</a></p> <ul> <li>We are going to use existing configuration by olafhartong</li> </ul> <p><a href="https://github.com/olafhartong/sysmon-modular">https://github.com/olafhartong/sysmon-modular</a></p> <p><a href="https://raw.githubusercontent.com/olafhartong/sysmon-modular/master/sysmonconfig.xml">https://raw.githubusercontent.com/olafhartong/sysmon-modular/master/sysmonconfig.xml</a></p> <ul> <li>Install by opening up a command prompt as administrator</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 32 bit

sysmon.exe â€“accepteula â€“i PATH/TO/sysmonconfig.xml

# 64 bit

sysmon64.exe â€“accepteula â€“i PATH/TO/sysmonconfig.xml
</code></pre></div></div> <ul> <li>Download Winlogbeat</li> </ul> <p><a href="https://artifacts.elastic.co/downloads/beats/winlogbeat/winlogbeat-8.3.2-windows-x86_64.zip">https://artifacts.elastic.co/downloads/beats/winlogbeat/winlogbeat-8.3.2-windows-x86_64.zip</a></p> <ul> <li> <p>Extract the contents into C:\Program Files.</p> </li> <li> <p>Rename the winlogbeat-<version> directory to Winlogbeat</version></p> </li> <li> <p>Using PowerShell prompt as an Administrator</p> </li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Access winlogbeat directory

cd 'C:\Program Files\Winlogbeat'

# Install winlogbeat service

.\install-service-winlogbeat.ps1

</code></pre></div></div> <ul> <li>Configure winlogbeat to connect ro the elastic stack</li> </ul> <p>winlogbeat.yml</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>output.elasticsearch:
  hosts: ["https://YOUR-HOST:9200"]
  username: "winlogbeat_internal"
  password: "YOUR_PASSWORD"
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># provide kibana host credential to setup dashboards

setup.kibana:
    host: "mykibanahost:5601" 
    username: "my_kibana_user"  
    password: "{pwd}"

</code></pre></div></div> <ul> <li>Setup assets</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.\winlogbeat.exe setup -e
</code></pre></div></div> <ul> <li>Start Winlogbeat</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Start-Service winlogbeat
</code></pre></div></div> <p><img src="https://i.ibb.co/Cb3WHM0/Screen-Shot-2022-07-16-at-9-16-20-PM.png" alt="winlogbeat" /></p> <p>You can check the Discover section to confirm data is shipping succesfully.</p> <p><img src="https://i.ibb.co/w7sBnDX/Screen-Shot-2022-07-16-at-9-18-02-PM.png" alt="discover" /></p><hr /> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
